@model Proyecto_Final_Desarrollo_Web.ViewModels.FacturaViewModel
@{
    ViewBag.Title = "Imprimir Factura";
    Layout = "~/Views/Shared/_LayoutPrint.cshtml"; // Layout simplificado para impresión
}

<div class="container-fluid mt-4 mb-5">
    <div class="row">
        <div class="col-12 text-center mb-4">
            <h1 class="fw-bold">FARMAU</h1>
            <p class="mb-0">Farmacia Universitaria</p>
            <p class="mb-0">Tel: (506) 2222-5555</p>
            <p>info@farmau.com</p>
            <hr class="my-3">
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <h2 class="text-center mb-4">FACTURA</h2>

            <div class="row mb-4">
                <div class="col-sm-6">
                    <p><strong>Factura #:</strong> @Model.id_Factura</p>
                    <p><strong>Fecha:</strong> @(Model.fecha.HasValue ? Model.fecha.Value.ToString("dd/MM/yyyy HH:mm") : "N/A")</p>
                    <p><strong>Estado:</strong> @Model.estado</p>
                </div>
                <div class="col-sm-6">
                    <p><strong>Cliente:</strong> @Model.NombreCliente</p>
                    <p><strong>Documento:</strong> @Model.DocumentoCliente</p>
                </div>
            </div>

            <!-- Detalles de productos -->
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var detalle in Model.Detalles)
                    {
                        <tr>
                            <td>
                                @detalle.NombreProducto
                                <small class="text-muted d-block">@detalle.Categoria</small>
                            </td>
                            <td class="text-center">@detalle.cantidad</td>
                            <td class="text-end">@detalle.PrecioUnitario.ToString("C2")</td>
                            <td class="text-end">@detalle.subtotal.ToString("C2")</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                        <td class="text-end">@(Model.Detalles.Sum(d => d.subtotal)).ToString("C2")</td>
                    </tr>
                    <tr>
                        <td colspan="3" class="text-end"><strong>IVA (13%):</strong></td>
                        <td class="text-end">@(Model.Detalles.Sum(d => d.subtotal) * 0.13m).ToString("C2")</td>
                    </tr>
                    <tr>
                        <td colspan="3" class="text-end"><strong>TOTAL:</strong></td>
                        <td class="text-end"><strong>@Model.total.ToString("C2")</strong></td>
                    </tr>
                </tfoot>
            </table>

            <!-- Información adicional -->
            <div class="row mt-4">
                <div class="col-12">
                    @if (!string.IsNullOrEmpty(Model.MetodoPagoSeleccionado))
                    {
                        <p><strong>Método de pago:</strong> @Model.MetodoPagoSeleccionado</p>
                    }

                    @if (!string.IsNullOrEmpty(Model.notas))
                    {
                        <p><strong>Notas:</strong> @Model.notas</p>
                    }

                    <hr class="my-4">

                    <p class="text-center mb-0">¡Gracias por su compra!</p>
                    <p class="text-center">
                        <small>Esta factura fue generada el @DateTime.Now.ToString("dd/MM/yyyy HH:mm")</small>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // Imprimir automáticamente
    window.onload = function() {
        window.print();
    }
</script>